language: haskell
sudo: false

dist: xenial

git:
  submodules: false  # whether to recursively clone submodules

cache:
  directories:
    - $HOME/.cabal/packages
    - $HOME/.cabal/store

cabal: "2.4"

before_cache:
  - cabal v2-clean
  - rm -fv $HOME/.cabal/packages/hackage.haskell.org/build-reports.log
  # remove files that are regenerated by 'cabal update'
  - rm -fv $HOME/.cabal/packages/hackage.haskell.org/00-index.*
  - rm -fv $HOME/.cabal/packages/hackage.haskell.org/*.json
  - rm -fv $HOME/.cabal/packages/hackage.haskell.org/01-index.cache
  - rm -fv $HOME/.cabal/packages/hackage.haskell.org/01-index.tar
  - rm -fv $HOME/.cabal/packages/hackage.haskell.org/01-index.tar.idx

  - rm -rfv $HOME/.cabal/packages/head.hackage

matrix:
  include:
    - ghc: "8.6.3"
    - ghc: "8.4.4"
    - ghc: "8.2.2"
    - ghc: "8.0.2"


install:
  - cabal --version
  - ghc --version

# Here starts the actual work to be performed for the package under test;
# any command which exits with a non-zero exit code causes the build to fail.
script:
  - travis_retry cabal v2-update -v
  - cabal v2-build
  - cabal v2-test --enable-tests
  - cabal v2-bench --enable-benchmarks
